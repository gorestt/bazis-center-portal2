
{% extends 'base.html' %}
{% block title %}Публичные KPI{% endblock %}
{% block content %}
<h1 class="mb-3">Публичные KPI IT-сервисов</h1>
<div class="row">
  <div class="col-lg-8 mb-4">
    <div class="card">
      <div class="card-header">KPI по дням</div>
      <div class="card-body">
        <canvas id="kpiChart"></canvas>
      </div>
    </div>
  </div>
  <div class="col-lg-4 mb-4">
    <div class="card h-100">
      <div class="card-header">Последние записи</div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for r in kpi %}
          <li class="list-group-item d-flex justify-content-between">
            <span>{{ r.metric }} ({{ r.service_name }})</span>
            <span class="fw-semibold">{{ r.value }}</span>
          </li>
          {% empty %}
          <li class="list-group-item text-muted">Записей пока нет.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('kpiChart');
  if (!ctx) return;
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Пн','Вт','Ср','Чт','Пт','Сб','Вс'],
      datasets: [{
        label: 'Среднее время решения (часы)',
        data: [4.1,3.8,3.5,3.2,3.0,3.6,3.3],
        tension: 0.3,
        fill: false
      }]
    },
    options: {
      plugins: {legend: {display: true}},
      scales: {
        y: {beginAtZero: false}
      }
    }
  });
});
</script>
{% endblock %}
