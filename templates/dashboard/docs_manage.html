
{% extends 'base.html' %}
{% block title %}Управление документацией{% endblock %}

{% block content %}
<h1 class="mb-3">Управление документацией</h1>

<div class="row g-4">
  <div class="col-md-7">
    <h5 class="mb-3">Список документов</h5>
    <table class="table table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>Название</th>
          <th>Доступ</th>
          <th>Файл</th>
          <th style="width: 180px;">Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for doc in docs %}
          <tr>
            <td>{{ doc.title }}</td>
            <td>
              {% if doc.access == 'public' %}
                Публичный
              {% elif doc.access == 'client' %}
                Клиенты
              {% else %}
                Внутренний
              {% endif %}
            </td>
            <td>
              {% if doc.file %}
                <a href="{{ doc.file.url }}" target="_blank">Скачать</a>
              {% else %}
                <span class="text-muted">не прикреплён</span>
              {% endif %}
            </td>
            <td>
              <div class="d-flex gap-2">
                <a href="{% url 'dashboard:docs_manage' %}?edit={{ doc.id }}" class="btn btn-sm btn-outline-primary">
                  Редактировать
                </a>
                <form method="post" onsubmit="return confirm('Удалить документ «{{ doc.title }}»?');">
                  {% csrf_token %}
                  <input type="hidden" name="delete_id" value="{{ doc.id }}">
                  <button type="submit" class="btn btn-sm btn-outline-danger">Удалить</button>
                </form>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="4" class="text-muted">Документы отсутствуют.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="col-md-5">
    {% if edit_obj %}
      <h5 class="mb-3">Редактирование документа</h5>
      <form method="post" enctype="multipart/form-data" class="card card-body">
        {% csrf_token %}
        <input type="hidden" name="save_id" value="{{ edit_obj.id }}">

        <div class="mb-3">
          <label class="form-label">Название</label>
          {{ form.title }}
        </div>

        <div class="mb-3">
          <label class="form-label">Доступ</label>
          {{ form.access }}
        </div>

        <div class="mb-3">
          <label class="form-label">Файл</label>
          {{ form.file }}
          {% if edit_obj.file %}
            <div class="form-text">
              Текущий файл:
              <a href="{{ edit_obj.file.url }}" target="_blank">
                {{ edit_obj.file.name|slice:"5:" }}
              </a>
            </div>
          {% endif %}
        </div>

        <div class="d-flex justify-content-between">
          <button type="submit" class="btn btn-primary">Сохранить</button>
          <a href="{% url 'dashboard:docs_manage' %}" class="btn btn-outline-secondary">Отмена</a>
        </div>
      </form>
    {% else %}
      <h5 class="mb-3">Выберите документ для редактирования</h5>
      <p class="text-muted">
        Нажмите «Редактировать» в таблице слева, чтобы изменить название, доступ и файл документа.
      </p>
    {% endif %}
  </div>
</div>
{% endblock %}
