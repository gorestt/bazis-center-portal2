
{% extends 'base.html' %}
{% block title %}Очередь заявок{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="mb-0">Очередь заявок</h1>
  <a href="{% url 'dashboard:queue_create' %}" class="btn btn-primary">Новая заявка</a>
</div>
<form method="get" class="row g-2 mb-3">
  <div class="col-md-3">
    <label class="form-label">Статус</label>
    <select name="status" class="form-select">
      <option value="">Все</option>
      <option value="new" {% if status == 'new' %}selected{% endif %}>Новая</option>
      <option value="in_progress" {% if status == 'in_progress' %}selected{% endif %}>В работе</option>
      <option value="done" {% if status == 'done' %}selected{% endif %}>Закрыта</option>
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Приоритет</label>
    <select name="priority" class="form-select">
      <option value="">Все</option>
      <option value="low" {% if priority == 'low' %}selected{% endif %}>Низкий</option>
      <option value="medium" {% if priority == 'medium' %}selected{% endif %}>Средний</option>
      <option value="high" {% if priority == 'high' %}selected{% endif %}>Высокий</option>
    </select>
  </div>
  <div class="col-md-2 d-flex align-items-end">
    <button class="btn btn-outline-secondary w-100">Фильтровать</button>
  </div>
</form>
<table class="table table-hover align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>Тема</th>
      <th>Создана</th>
      <th>Приоритет</th>
      <th>Статус</th>
      <th>Исполнитель</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for o in page_obj %}
    <tr>
      <td>{{ o.id }}</td>
      <td>{{ o.title }}</td>
      <td>{{ o.created_at|date:"d.m.Y H:i" }}</td>
      <td>{{ o.get_priority_display }}</td>
      <td>{{ o.get_status_display }}</td>
      <td>{{ o.executor or "-" }}</td>
      <td class="text-end">
        <a href="{% url 'dashboard:queue_detail' o.id %}" class="btn btn-sm btn-outline-secondary">Открыть</a>
        <a href="{% url 'dashboard:queue_edit' o.id %}" class="btn btn-sm btn-outline-primary">Редактировать</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="7" class="text-muted text-center">Заявок пока нет.</td></tr>
    {% endfor %}
  </tbody>
</table>
<nav>
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if status %}&status={{ status }}{% endif %}{% if priority %}&priority={{ priority }}{% endif %}">&laquo;</a></li>
    {% endif %}
    <li class="page-item active"><span class="page-link">{{ page_obj.number }}/{{ page_obj.paginator.num_pages }}</span></li>
    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if status %}&status={{ status }}{% endif %}{% if priority %}&priority={{ priority }}{% endif %}">&raquo;</a></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}
